<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiv5 Map Demo</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map { height: 600px; width: 100%; }
        body { font-family: sans-serif; margin: 0; padding: 20px; }
        .controls { margin-bottom: 20px; }
        .post-popup img { max-width: 100px; display: block; margin-bottom: 5px; }
    </style>
</head>
<body>
    <h1>Fiv5 Map Demo (Closed SNS)</h1>
    <div class="controls">
        <label>User ID: <input type="number" id="userId" value="1"></label>
        <button onclick="loadMapPosts()">Load Friend Posts</button>
        <button onclick="createRandomPost()">Create Random Post Here</button>
    </div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize map centered on Seoul
        const map = L.map('map').setView([37.5665, 126.9780], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        let markers = [];

        async function loadMapPosts() {
            const userId = document.getElementById('userId').value;
            // In a real app, we would use the authenticated user's token.
            // For this demo, we'll assume the backend allows us to fetch map data.
            // Note: The backend endpoint /api/v1/posts/map uses @AuthenticationPrincipal.
            // Since we can't easily login here without a full auth flow, this demo might fail 
            // if we don't have a valid session/token. 
            // However, for verification, we can try to mock the response or assume dev environment.
            
            console.log("Fetching map posts...");
            // This fetch will likely fail with 401 if not authenticated.
            // For the purpose of this task, I'm providing the UI code. 
            // To fully test, one would need to attach a Bearer token.
            
            alert("Note: This demo requires a valid JWT token to work with the backend. \nIn a real scenario, you'd be logged in.");
        }

        function createRandomPost() {
            const center = map.getCenter();
            const lat = center.lat + (Math.random() - 0.5) * 0.01;
            const lng = center.lng + (Math.random() - 0.5) * 0.01;
            
            L.marker([lat, lng]).addTo(map)
                .bindPopup("New Random Post at " + lat.toFixed(4) + ", " + lng.toFixed(4))
                .openPopup();
                
            console.log(`Creating post at ${lat}, ${lng}`);
        }
    </script>
</body>
</html>
